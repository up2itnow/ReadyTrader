# ReadyTrader-Crypto MCP Tool Catalog

This file is automatically generated from the registered tools in `server.py`.

> [!TIP]
> AI agents can use these tools to gather intelligence, assess risk, and execute trades.

______________________________________________________________________

## Tool Categories Overview

| Category                    | Tools | Purpose                                            |
| :-------------------------- | :---- | :------------------------------------------------- |
| **Trading & Risk**          | 2     | Paper trading deposits and trade risk validation   |
| **Execution (DEX/CEX)**     | 15    | Order placement, management, and WebSocket streams |
| **Market Data**             | 4     | Price feeds, historical data, sentiment, news      |
| **Research & Intelligence** | 7     | Social sentiment, market regime, backtesting       |

______________________________________________________________________

## Trading & Risk

| Tool Name                                     | Description                                                    |
| :-------------------------------------------- | :------------------------------------------------------------- |
| [`deposit_paper_funds`](#deposit_paper_funds) | [PAPER MODE] Deposit fake funds into the paper trading wallet. |
| [`validate_trade_risk`](#validate_trade_risk) | [GUARDIAN] Validate if a trade is safe to execute.             |

### `deposit_paper_funds`

**Signature:** `deposit_paper_funds(asset: str, amount: float) -> str`

```text
[PAPER MODE] Deposit fake funds into the paper trading wallet.

Use this tool to initialize or top-up your paper trading balance for testing
strategies without risking real funds. Only works when PAPER_MODE=true.

Parameters:
- asset: The asset symbol to deposit (e.g., "USDC", "ETH", "BTC")
- amount: The amount to deposit (e.g., 10000.0 for $10,000 USDC)

Returns:
- JSON response with deposit confirmation and updated balance

Example:
  deposit_paper_funds("USDC", 10000.0)
  → Deposits 10,000 USDC into the paper wallet

Error Codes:
- paper_mode_required: Paper mode is not enabled
```

### `validate_trade_risk`

**Signature:** `validate_trade_risk(side: str, symbol: str, amount_usd: float, portfolio_value: float) -> str`

```text
[GUARDIAN] Validate if a trade is safe to execute.

The Risk Guardian enforces hard-coded safety rules to protect against:
- Excessive position sizing (>5% of portfolio)
- Daily loss limits (>5% daily drawdown)
- Max drawdown protection (>10% from peak)
- Falling knife protection (buying in extreme bearish conditions)

Parameters:
- side: "buy" or "sell"
- symbol: Trading pair (e.g., "BTC/USDT")
- amount_usd: Trade value in USD
- portfolio_value: Total portfolio value in USD

Returns:
- JSON with { allowed: bool, reason: string }

Example:
  validate_trade_risk("buy", "BTC/USDT", 500, 10000)
  → Validates a $500 BTC buy against a $10,000 portfolio

Risk Rules Applied:
1. Position Size: Max 5% of portfolio per trade
2. Daily Loss: Halts buys if daily loss exceeds 5%
3. Max Drawdown: Halts buys if drawdown exceeds 10%
4. Falling Knife: Blocks buys when sentiment < -0.5
```

______________________________________________________________________

## Execution (DEX/CEX)

| Tool Name                                               | Description                                                    |
| :------------------------------------------------------ | :------------------------------------------------------------- |
| [`swap_tokens`](#swap_tokens)                           | Swap tokens on a DEX (paper mode or live).                     |
| [`transfer_eth`](#transfer_eth)                         | Transfer native currency (ETH/BASE/ARB/OP native token).       |
| [`place_cex_order`](#place_cex_order)                   | Place an order on a CEX using CCXT authenticated credentials.  |
| [`get_cex_balance`](#get_cex_balance)                   | Fetch account balance from a centralized exchange.             |
| [`get_cex_order`](#get_cex_order)                       | Fetch details of a specific order from a centralized exchange. |
| [`cancel_cex_order`](#cancel_cex_order)                 | Cancel an open order on a centralized exchange.                |
| [`get_cex_capabilities`](#get_cex_capabilities)         | Query exchange capabilities and market information.            |
| [`list_cex_open_orders`](#list_cex_open_orders)         | List all currently open (unfilled) orders on an exchange.      |
| [`list_cex_orders`](#list_cex_orders)                   | List recent orders (open, filled, cancelled) from an exchange. |
| [`get_cex_my_trades`](#get_cex_my_trades)               | Fetch executed trades (fills) from a centralized exchange.     |
| [`cancel_all_cex_orders`](#cancel_all_cex_orders)       | Cancel all open orders on a centralized exchange.              |
| [`replace_cex_order`](#replace_cex_order)               | Replace (edit) an existing order on a centralized exchange.    |
| [`wait_for_cex_order`](#wait_for_cex_order)             | Wait for an order to reach a terminal state.                   |
| [`start_cex_private_ws`](#start_cex_private_ws)         | Start a private WebSocket stream for order updates.            |
| [`stop_cex_private_ws`](#stop_cex_private_ws)           | Stop a private WebSocket stream for order updates.             |
| [`list_cex_private_updates`](#list_cex_private_updates) | List recent private updates from exchange streams.             |

### `swap_tokens`

**Signature:** `swap_tokens(from_token: str, to_token: str, amount: float, chain: str = "ethereum", rationale: str = "", idempotency_key: str = "") -> str`

```text
Swap tokens on a DEX (paper mode or live).

In paper mode, simulates the swap without real execution.
In live mode:
  - Builds a swap transaction using 1inch aggregator
  - Signs with configured signer (supports env_key, keystore, remote, MPC)
  - Broadcasts via JSON-RPC to the blockchain

Parameters:
- from_token: Source token symbol or contract address (e.g., "ETH", "USDC", "0x...")
- to_token: Destination token symbol or contract address
- amount: Amount to swap (in human-readable units, e.g., 1.5 ETH)
- chain: Blockchain network ("ethereum", "base", "arbitrum", "optimism")
- rationale: Optional reason for the trade (for audit trail)
- idempotency_key: Optional unique key to prevent duplicate executions

Returns:
- JSON with transaction hash (live) or simulation result (paper)

Supported Chains:
- ethereum (chainId: 1)
- base (chainId: 8453)
- arbitrum (chainId: 42161)
- optimism (chainId: 10)

Safety Features:
- Policy validation (chain, token, amount limits)
- Router address allowlist verification
- Signer policy constraints
- Idempotency protection against replay

Error Codes:
- execution_error: General execution failure
- chain_not_allowed: Chain not in ALLOW_CHAINS
- token_not_allowed: Token not in ALLOW_TOKENS
- trade_amount_too_large: Exceeds MAX_TRADE_AMOUNT
```

### `transfer_eth`

**Signature:** `transfer_eth(to_address: str, amount: float, chain: str = "ethereum", idempotency_key: str = "") -> str`

```text
Transfer native currency (ETH/BASE/ARB/OP native token).

Live mode signs and broadcasts via JSON-RPC.
Not supported in paper mode.

Parameters:
- to_address: Recipient wallet address (0x...)
- amount: Amount to transfer in native units (e.g., 0.1 for 0.1 ETH)
- chain: Blockchain network ("ethereum", "base", "arbitrum", "optimism")
- idempotency_key: Optional unique key to prevent duplicate transfers

Returns:
- JSON with transaction hash and confirmation

Safety Features:
- Recipient allowlist (ALLOW_TO_ADDRESSES)
- Transfer amount limit (MAX_TRANSFER_NATIVE)
- Signer policy validation

Error Codes:
- paper_mode_not_supported: Native transfers not available in paper mode
- transfer_error: General transfer failure
- recipient_not_allowed: Address not in allowlist
- transfer_amount_too_large: Exceeds MAX_TRANSFER_NATIVE
```

### `place_cex_order`

**Signature:** `place_cex_order(symbol: str, side: str, amount: float, order_type: str = "market", price: float | None = None, exchange: str = "binance", market_type: str = "spot", idempotency_key: str = "") -> str`

```text
Place an order on a CEX using CCXT authenticated credentials.

In paper mode, this routes to the paper engine and does NOT require CEX credentials.
In live mode, executes against the real exchange.

Parameters:
- symbol: Trading pair (e.g., "BTC/USDT", "ETH/USDC")
- side: "buy" or "sell"
- amount: Order quantity in base currency units
- order_type: "market" (immediate) or "limit" (price-specified)
- price: Limit price (required for limit orders, ignored for market)
- exchange: Exchange ID (e.g., "binance", "kraken", "coinbase")
- market_type: "spot", "swap", or "future"
- idempotency_key: Optional unique key to prevent duplicate orders

Returns:
- JSON with order details including order ID, status, and fill info

Supported Exchanges (100+ via CCXT):
- Tier 1: binance, kraken, coinbase, bybit, okx
- See docs/EXCHANGES.md for full compatibility matrix

Safety Features:
- Policy validation (exchange, symbol, amount limits)
- Approval gate in approve_each mode
- Idempotency protection

Error Codes:
- cex_error: Exchange API error
- execution_mode_blocked: CEX disabled by EXECUTION_MODE=dex
- exchange_not_allowed: Exchange not in ALLOW_EXCHANGES
- order_amount_too_large: Exceeds MAX_CEX_ORDER_AMOUNT
```

### `get_cex_balance`

**Signature:** `get_cex_balance(exchange: str = "binance", market_type: str = "spot") -> str`

```text
Fetch account balance from a centralized exchange.

Returns the balance of all assets in the account. Requires CEX credentials
configured via environment variables (CEX_API_KEY, CEX_API_SECRET).

Parameters:
- exchange: Exchange ID (e.g., "binance", "kraken", "coinbase")
- market_type: "spot", "swap", or "future"

Returns:
- JSON with all asset balances (free, used, total)

Required Environment Variables:
- CEX_API_KEY or CEX_{EXCHANGE}_API_KEY
- CEX_API_SECRET or CEX_{EXCHANGE}_API_SECRET
- CEX_API_PASSWORD (optional, for some exchanges)

Error Codes:
- cex_error: Exchange API error or authentication failure
```

### `get_cex_order`

**Signature:** `get_cex_order(order_id: str, symbol: str = "", exchange: str = "binance", market_type: str = "spot") -> str`

```text
Fetch details of a specific order from a centralized exchange.

Retrieves the current state of an order including fill status, executed
quantity, and average price. Useful for tracking order execution.

Parameters:
- order_id: Exchange order ID
- symbol: Trading pair (may be required by some exchanges)
- exchange: Exchange ID
- market_type: "spot", "swap", or "future"

Returns:
- JSON with normalized order details:
  - id, symbol, side, type, status
  - amount, filled, remaining
  - price, average, cost
  - timestamp, datetime

Error Codes:
- cex_error: Order not found or API error
```

### `cancel_cex_order`

**Signature:** `cancel_cex_order(order_id: str, symbol: str = "", exchange: str = "binance", market_type: str = "spot") -> str`

```text
Cancel an open order on a centralized exchange.

Attempts to cancel an unfilled or partially filled order. Returns the
cancellation result. Note: orders may fill before cancellation completes.

Parameters:
- order_id: Exchange order ID to cancel
- symbol: Trading pair (may be required by some exchanges)
- exchange: Exchange ID
- market_type: "spot", "swap", or "future"

Returns:
- JSON with cancellation confirmation

Important Notes:
- Race condition: Order may fill before cancel reaches exchange
- Partial fills: Only unfilled portion is cancelled
- Some exchanges have cancel cooldowns

Error Codes:
- cex_error: Order not found, already filled, or API error
```

### `get_cex_capabilities`

**Signature:** `get_cex_capabilities(exchange: str = "binance", symbol: str = "", market_type: str = "spot") -> str`

```text
Query exchange capabilities and market information.

Returns supported features, order types, timeframes, and market metadata
for the specified exchange. Useful for determining available functionality
before placing orders. Does not require authentication.

Parameters:
- exchange: Exchange ID
- symbol: Optional specific symbol for market info
- market_type: "spot", "swap", or "future"

Returns:
- JSON with capabilities:
  - has: Feature flags (createOrder, fetchBalance, etc.)
  - timeframes: Supported OHLCV intervals
  - market: Symbol-specific limits and precision

Use Cases:
- Check if exchange supports cancelAllOrders
- Get minimum order size for a symbol
- Verify supported order types

Error Codes:
- cex_error: Exchange initialization failed
- execution_mode_blocked: CEX disabled by EXECUTION_MODE=dex
```

### `list_cex_open_orders`

**Signature:** `list_cex_open_orders(exchange: str = "binance", symbol: str = "", market_type: str = "spot", limit: int = 100) -> str`

```text
List all currently open (unfilled) orders on a centralized exchange.

Returns orders that are pending execution. Can be filtered by symbol.
Useful for monitoring active positions and managing order book exposure.

Parameters:
- exchange: Exchange ID
- symbol: Optional filter by trading pair
- market_type: "spot", "swap", or "future"
- limit: Maximum orders to return (default: 100)

Returns:
- JSON with array of normalized open orders

Error Codes:
- cex_error: API error or authentication failure
```

### `list_cex_orders`

**Signature:** `list_cex_orders(exchange: str = "binance", symbol: str = "", market_type: str = "spot", limit: int = 100) -> str`

```text
List recent orders (open, filled, and cancelled) from a centralized exchange.

Returns order history including both active and completed orders. Useful
for reviewing trading activity and reconciling execution history.

Parameters:
- exchange: Exchange ID
- symbol: Optional filter by trading pair
- market_type: "spot", "swap", or "future"
- limit: Maximum orders to return (default: 100)

Returns:
- JSON with array of normalized orders (all statuses)

Error Codes:
- cex_error: API error or authentication failure
```

### `get_cex_my_trades`

**Signature:** `get_cex_my_trades(exchange: str = "binance", symbol: str = "", market_type: str = "spot", limit: int = 100) -> str`

```text
Fetch executed trades (fills) from a centralized exchange.

Returns actual trade executions with price, quantity, and fee information.
Useful for P&L calculation, tax reporting, and execution analysis.

Parameters:
- exchange: Exchange ID
- symbol: Optional filter by trading pair
- market_type: "spot", "swap", or "future"
- limit: Maximum trades to return (default: 100)

Returns:
- JSON with trade details:
  - id, order, symbol, side
  - price, amount, cost
  - fee (currency, cost, rate)
  - timestamp

Use Cases:
- Calculate realized P&L
- Export for tax reporting
- Analyze execution quality (slippage)

Error Codes:
- cex_error: API error or authentication failure
```

### `cancel_all_cex_orders`

**Signature:** `cancel_all_cex_orders(exchange: str = "binance", symbol: str = "", market_type: str = "spot") -> str`

```text
Cancel all open orders on a centralized exchange.

Emergency function to cancel all pending orders. Can be filtered by symbol.
Useful for risk management and rapid position unwinding.
Note: not all exchanges support this operation.

Parameters:
- exchange: Exchange ID
- symbol: Optional filter by trading pair (cancel all if empty)
- market_type: "spot", "swap", or "future"

Returns:
- JSON with cancellation results

⚠️ Warning:
- This is a high-impact operation
- Use get_cex_capabilities to verify support first
- Some exchanges may have rate limits on mass cancellation

Error Codes:
- cex_error: Exchange doesn't support cancelAllOrders
```

### `replace_cex_order`

**Signature:** `replace_cex_order(exchange: str, order_id: str, symbol: str, side: str, amount: float, order_type: str = "limit", price: float | None = None, market_type: str = "spot") -> str`

```text
Replace (edit) an existing order on a centralized exchange.

Atomically cancels the existing order and places a new one with updated
parameters. Useful for adjusting limit prices without losing queue position.
Note: not all exchanges support this operation.

Parameters:
- exchange: Exchange ID
- order_id: Existing order ID to replace
- symbol: Trading pair
- side: "buy" or "sell"
- amount: New order quantity
- order_type: "market" or "limit"
- price: New limit price
- market_type: "spot", "swap", or "future"

Returns:
- JSON with new order details

Advantages over Cancel+Create:
- Atomic operation (no gap between cancel and new order)
- May preserve queue position on some exchanges

Error Codes:
- cex_error: Exchange doesn't support editOrder
```

### `wait_for_cex_order`

**Signature:** `wait_for_cex_order(exchange: str, order_id: str, symbol: str = "", market_type: str = "spot", timeout_sec: int = 30, poll_interval_sec: float = 2.0) -> str`

```text
Wait for an order to reach a terminal state (filled, cancelled, rejected).

Polls the exchange at regular intervals until the order completes or
the timeout is reached. Useful for synchronous execution flows.
Returns the final order state.

Parameters:
- exchange: Exchange ID
- order_id: Order ID to monitor
- symbol: Trading pair
- market_type: "spot", "swap", or "future"
- timeout_sec: Maximum wait time (default: 30 seconds)
- poll_interval_sec: Time between polls (default: 2.0 seconds)

Returns:
- JSON with final order state

Terminal States:
- closed (filled)
- canceled / cancelled
- rejected
- expired

Error Codes:
- timeout: Order did not reach terminal state within timeout
- cex_error: API error during polling
```

### `start_cex_private_ws`

**Signature:** `start_cex_private_ws(exchange: str = "binance", market_type: str = "spot") -> str`

```text
Start a private WebSocket stream for real-time order/execution updates.

Supports native WebSocket for: Binance, Kraken, Coinbase.
For other exchanges, falls back to REST polling.
Provides real-time notifications of order fills and status changes.

Parameters:
- exchange: Exchange ID
- market_type: "spot", "swap", or "future"

Returns:
- JSON with stream status { mode: "ws"|"poll", status: "started" }

WebSocket Support:
- binance: Native WebSocket (user data stream)
- kraken: Native WebSocket (private channel)
- coinbase: Native WebSocket (user channel)
- others: REST polling fallback

Error Codes:
- paper_mode_not_supported: Private updates not available in paper mode
- cex_error: Stream initialization failed
```

### `stop_cex_private_ws`

**Signature:** `stop_cex_private_ws(exchange: str = "binance", market_type: str = "spot") -> str`

```text
Stop a private WebSocket stream for order/execution updates.

Cleanly disconnects from the exchange's private update channel.
Should be called when monitoring is no longer needed.

Parameters:
- exchange: Exchange ID
- market_type: "spot", "swap", or "future"

Returns:
- JSON with stream status { status: "stopped" }

Error Codes:
- paper_mode_not_supported: Private updates not available in paper mode
```

### `list_cex_private_updates`

**Signature:** `list_cex_private_updates(exchange: str = "binance", market_type: str = "spot", limit: int = 100) -> str`

```text
List recent private updates (order fills, status changes) from exchange.

Returns buffered events from the active private update stream.
Events include order executions, status changes, and account updates.
Requires start_cex_private_ws to be called first.

Parameters:
- exchange: Exchange ID
- market_type: "spot", "swap", or "future"
- limit: Maximum events to return (default: 100)

Returns:
- JSON with array of update events

Event Types:
- ORDER_UPDATE: Order status change
- TRADE: Fill/execution event
- BALANCE_UPDATE: Account balance change

Error Codes:
- paper_mode_not_supported: Private updates not available in paper mode
```

______________________________________________________________________

## Market Data

| Tool Name                               | Description                                |
| :-------------------------------------- | :----------------------------------------- |
| [`get_crypto_price`](#get_crypto_price) | Get the current price of a cryptocurrency. |
| [`fetch_ohlcv`](#fetch_ohlcv)           | Fetch historical OHLCV (candlestick) data. |
| [`get_sentiment`](#get_sentiment)       | Get the current Crypto Fear & Greed Index. |
| [`get_news`](#get_news)                 | Get aggregated crypto market news.         |

### `get_crypto_price`

**Signature:** `get_crypto_price(symbol: str, exchange: str = "binance") -> str`

```text
Get the current price of a cryptocurrency.

Fetches real-time price data from the MarketDataBus which aggregates
data from multiple sources with freshness scoring.

Parameters:
- symbol: Trading pair (e.g., "BTC/USDT", "ETH/USDC")
- exchange: Preferred exchange source (default: "binance")

Returns:
- JSON with current price and data source

Data Priority (MarketDataBus):
1. WebSocket store (real-time, highest priority)
2. Ingest store (user-supplied feeds)
3. CCXT REST (fallback)

Error Codes:
- fetch_price_error: Unable to fetch price data
```

### `fetch_ohlcv`

**Signature:** `fetch_ohlcv(symbol: str, timeframe: str = "1h", limit: int = 24) -> str`

```text
Fetch historical OHLCV (candlestick) data.

Retrieves Open, High, Low, Close, Volume data for technical analysis
and strategy development.

Parameters:
- symbol: Trading pair (e.g., "BTC/USDT")
- timeframe: Candle interval ("1m", "5m", "15m", "1h", "4h", "1d", etc.)
- limit: Number of candles to fetch (default: 24)

Returns:
- JSON with array of OHLCV records:
  - timestamp: Unix timestamp (ms)
  - open, high, low, close: Price values
  - volume: Trading volume

Supported Timeframes:
- Minutes: 1m, 3m, 5m, 15m, 30m
- Hours: 1h, 2h, 4h, 6h, 12h
- Days: 1d, 3d, 1w, 1M

Error Codes:
- fetch_ohlcv_error: Unable to fetch historical data
```

### `get_sentiment`

**Signature:** `get_sentiment() -> str`

```text
Get the current Crypto Fear & Greed Index.

Returns market sentiment indicator ranging from 0 (Extreme Fear) to 100
(Extreme Greed). Useful for contrarian trading and risk assessment.

Parameters: None

Returns:
- JSON with sentiment data:
  - value: 0-100 sentiment score
  - classification: "Extreme Fear" | "Fear" | "Neutral" | "Greed" | "Extreme Greed"
  - timestamp: Data freshness

Interpretation:
- 0-24: Extreme Fear (potential buying opportunity)
- 25-49: Fear
- 50-74: Greed
- 75-100: Extreme Greed (potential selling signal)
```

### `get_news`

**Signature:** `get_news() -> str`

```text
Get aggregated crypto market news.

Returns recent news headlines and summaries from multiple sources.
Useful for fundamental analysis and event-driven trading.

Parameters: None

Returns:
- JSON with array of news items:
  - title: Headline
  - summary: Brief description
  - source: News source
  - url: Link to full article
  - published_at: Publication timestamp
```

______________________________________________________________________

## Research & Intelligence

| Tool Name                                             | Description                                             |
| :---------------------------------------------------- | :------------------------------------------------------ |
| [`get_social_sentiment`](#get_social_sentiment)       | Get social media sentiment analysis (X/Reddit).         |
| [`get_financial_news`](#get_financial_news)           | Get high-tier financial news (Bloomberg/Reuters style). |
| [`get_free_news`](#get_free_news)                     | Get free market news from RSS feeds.                    |
| [`get_market_regime`](#get_market_regime)             | Detect market regime (TRENDING, RANGING, VOLATILE).     |
| [`run_backtest_simulation`](#run_backtest_simulation) | Run a strategy simulation against historical data.      |
| [`post_market_insight`](#post_market_insight)         | Share a market insight with other agents.               |
| [`get_latest_insights`](#get_latest_insights)         | Get the most recent high-signal insights.               |

### `get_social_sentiment`

**Signature:** `get_social_sentiment(symbol: str) -> str`

```text
Get social media sentiment analysis (X/Reddit).

Analyzes social media discussions to gauge community sentiment around
a specific cryptocurrency. Uses NLP for sentiment scoring.

Parameters:
- symbol: Cryptocurrency symbol (e.g., "BTC", "ETH")

Returns:
- JSON with sentiment analysis:
  - overall_score: -1.0 to 1.0 sentiment scale
  - volume: Number of mentions analyzed
  - trending_topics: Related hashtags/topics
  - sources: Breakdown by platform (X, Reddit)

Note: In demo mode, returns simulated sentiment data.
Configure API keys for live social feeds.
```

### `get_financial_news`

**Signature:** `get_financial_news(symbol: str) -> str`

```text
Get high-tier financial news (Bloomberg/Reuters style).

Returns institutional-grade financial news and analysis.
Useful for fundamental analysis and macro context.

Parameters:
- symbol: Asset symbol (e.g., "BTC", "ETH")

Returns:
- JSON with financial news:
  - headlines: Array of recent articles
  - analyst_commentary: Expert opinions
  - price_targets: Institutional predictions

Note: In demo mode, returns simulated news data.
Configure NEWS_API_KEY for live news feeds.
```

### `get_free_news`

**Signature:** `get_free_news(symbol: str = "") -> str`

```text
Get free market news from RSS feeds.

Aggregates news from free public RSS sources including CoinDesk,
CoinTelegraph, and other crypto news outlets.

Parameters:
- symbol: Optional filter by asset (empty for all news)

Returns:
- JSON with news items from RSS feeds

Sources:
- CoinDesk RSS
- CoinTelegraph RSS
- Bitcoin Magazine RSS
- Decrypt RSS
```

### `get_market_regime`

**Signature:** `get_market_regime(symbol: str, timeframe: str = "1d") -> str`

```text
Detect the current market regime (TRENDING, RANGING, VOLATILE).

Uses ADX (Average Directional Index) and volatility metrics to classify
the current market state. Critical for strategy selection.

Parameters:
- symbol: Trading pair (e.g., "BTC/USDT")
- timeframe: Analysis timeframe (default: "1d")

Returns:
- JSON with regime classification:
  - regime: "TRENDING" | "RANGING" | "VOLATILE"
  - direction: "UP" | "DOWN" | "NEUTRAL"
  - adx: ADX indicator value (0-100)
  - volatility: Volatility percentile

Strategy Implications:
- TRENDING (ADX > 25): Use trend-following strategies
- RANGING (ADX < 20): Use mean-reversion strategies
- VOLATILE (High ATR): Reduce position sizes

Error Codes:
- market_regime_error: Unable to calculate regime
```

### `run_backtest_simulation`

**Signature:** `run_backtest_simulation(strategy_code: str, symbol: str, timeframe: str = "1h") -> str`

````text
Run a strategy simulation against historical data.

Executes your strategy code in a sandboxed environment against
historical price data to measure performance.

Parameters:
- strategy_code: Python code defining 'def on_candle(price, rsi, state)'
- symbol: Trading pair (e.g., "BTC/USDT")
- timeframe: Candle interval (default: "1h")

Returns:
- JSON with backtest results:
  - initial_capital: Starting balance
  - final_value: Ending portfolio value
  - pnl: Absolute profit/loss
  - pnl_percent: Percentage return
  - total_trades: Number of trades executed
  - trades_log: Last 5 trades

Strategy Code Requirements:
- Must define: def on_candle(price, rsi, state) -> str
- Return values: "buy", "sell", or "hold"
- 'state' dict persists across candles

Example Strategy:
```python
def on_candle(price, rsi, state):
    if rsi < 30:
        return "buy"
    elif rsi > 70:
        return "sell"
    return "hold"
````

Security:

- Code runs in RestrictedPython sandbox
- Limited imports (only 'math' allowed)
- No file/network access

Error Codes:

- Strategy Compilation Error: Invalid Python syntax
- Runtime error: Error during execution

````

### `post_market_insight`

**Signature:** `post_market_insight(symbol: str, agent_id: str, signal: str, confidence: float, reasoning: str, ttl_seconds: int = 3600) -> str`

```text
[PHASE 3] Share a market insight with other agents.

Multi-agent collaboration tool allowing research agents to share
high-signal insights with execution agents.

Parameters:
- symbol: Asset symbol (e.g., "BTC/USDT")
- agent_id: Unique identifier for the posting agent
- signal: "BULLISH" | "BEARISH" | "NEUTRAL"
- confidence: Confidence score 0.0-1.0
- reasoning: Explanation for the signal
- ttl_seconds: Time-to-live in seconds (default: 3600)

Returns:
- JSON with insight details including unique insight_id

Use Case:
1. Researcher agent analyzes market → posts insight
2. Executor agent queries insights → makes trade decision
3. Trades can reference insight_id for audit trail
````

### `get_latest_insights`

**Signature:** `get_latest_insights(symbol: str = "") -> str`

```text
[PHASE 3] Get the most recent high-signal insights.

Retrieves insights posted by research agents for multi-agent
coordination and decision support.

Parameters:
- symbol: Optional filter by asset (empty for all insights)

Returns:
- JSON with array of active insights:
  - insight_id: Unique identifier
  - symbol: Asset symbol
  - agent_id: Posting agent
  - signal: BULLISH/BEARISH/NEUTRAL
  - confidence: 0.0-1.0 score
  - reasoning: Explanation
  - created_at: Timestamp
  - expires_at: TTL expiration
```

______________________________________________________________________

## Error Response Format

All tools return JSON with a consistent structure:

**Success Response:**

```json
{
  "ok": true,
  "data": {
    // Tool-specific response data
  }
}
```

**Error Response:**

```json
{
  "ok": false,
  "error": {
    "code": "error_code",
    "message": "Human-readable error message",
    "data": {
      // Additional error context
    }
  }
}
```

**Common Error Codes:**

| Code                       | Description                                 |
| :------------------------- | :------------------------------------------ |
| `paper_mode_required`      | Operation requires PAPER_MODE=true          |
| `paper_mode_not_supported` | Operation not available in paper mode       |
| `execution_mode_blocked`   | Operation blocked by EXECUTION_MODE setting |
| `cex_error`                | CEX API error or authentication failure     |
| `execution_error`          | DEX execution failure                       |
| `rate_limited`             | Rate limit exceeded                         |
| `timeout`                  | Operation timed out                         |
| `chain_not_allowed`        | Chain not in ALLOW_CHAINS                   |
| `token_not_allowed`        | Token not in ALLOW_TOKENS                   |
| `exchange_not_allowed`     | Exchange not in ALLOW_EXCHANGES             |

______________________________________________________________________

## See Also

- `docs/ERRORS.md` - Detailed error catalog and troubleshooting
- `docs/EXCHANGES.md` - Exchange compatibility matrix
- `docs/MARKETDATA.md` - Market data architecture
- `docs/THREAT_MODEL.md` - Security considerations
